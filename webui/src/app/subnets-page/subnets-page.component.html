<app-breadcrumbs [items]="breadcrumbs">
    <div page-help>
        <p>This page displays a list of the subnets defined in the Kea instance.</p>
        <p>
            Stork retrieves subnet information using the
            <a href="https://kea.readthedocs.io/en/latest/api.html#config-get">config-get</a>
            command, which returns all subnets configured in your configuration file. If you are using
            <a href="https://kea.readthedocs.io/en/latest/arm/dhcp4-srv.html#configuration-backend-in-dhcpv4"
                >config backend</a
            >, the subnets that Kea retrieves from the database are listed here as well.
        </p>
    </div>
</app-breadcrumbs>

<app-tab-view
    routePath="/dhcp/subnets/"
    [entityProvider]="subnetProvider"
    [newFormProvider]="subnetFormProvider"
    [createTransactionDeleteAPICaller]="callCreateSubnetDeleteTransaction"
    [updateTransactionDeleteAPICaller]="callUpdateSubnetDeleteTransaction"
    entityTitleKey="subnet"
    [tableQueryParamFilters]="{
        subnetId: { type: 'numeric', matchMode: 'equals' },
        daemonId: { type: 'numeric', matchMode: 'equals' },
        dhcpVersion: { type: 'enum', matchMode: 'equals', enumValues: ['4', '6'] },
        text: { type: 'string', matchMode: 'contains' },
    }"
    [entitiesTable]="table()?.table"
    entityTypeName="Subnet"
    firstTabTitle="Subnets"
    [forceAsyncEntityFetch]="true"
>
    <ng-template #firstTab>
        <app-subnets-table
            #subnetsTableComponent
            [grafanaUrl]="grafanaUrl"
            [grafanaDhcp4DashboardId]="grafanaDhcp4DashboardId"
            [grafanaDhcp6DashboardId]="grafanaDhcp6DashboardId"
            [dataLoading]="loading"
        ></app-subnets-table>
    </ng-template>
    <ng-template #entityTab let-subnet let-onSubnetEditBegin="beginEntityEditFn" let-onSubnetDelete="deleteEntityFn">
        <app-subnet-tab
            [subnet]="subnet"
            (subnetEditBegin)="onSubnetEditBegin(subnet.id)"
            (subnetDelete)="onSubnetDelete(subnet.id)"
        ></app-subnet-tab>
    </ng-template>
    <ng-template
        #formTab
        let-subnet
        let-tabType="tabType"
        let-tabForm="tabForm"
        let-onSubnetFormDestroy="destroyFormFn"
        let-onSubnetFormSubmit="submitFormFn"
        let-onSubnetFormCancel="cancelFormFn"
    >
        <div class="max-w-50rem">
            <app-subnet-form
                [state]="tabForm.formState"
                [subnetId]="subnet?.id"
                (formDestroy)="onSubnetFormDestroy($event)"
                (formSubmit)="onSubnetFormSubmit($event, $event.subnetId)"
                (formCancel)="onSubnetFormCancel(tabType, subnet?.id)"
            ></app-subnet-form>
        </div>
    </ng-template>
</app-tab-view>
