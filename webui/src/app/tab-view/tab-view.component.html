<p-tabs [(value)]="activeTabEntityID" (valueChange)="logChange($event)">
    <p-tablist>
        @if (firstTabTemplate) {
            <p-tab
                [value]="0"
                [routerLink]="firstTabRoute()"
                [queryParams]="firstTabQueryParams()"
                [fragment]="tabNavigationRouteFragment()"
                >{{ firstTabTitle() }}</p-tab
            >
        }
        @for (tab of openTabs; track tab.value) {
            <p-tab [value]="tab.value" [routerLink]="tab.route">
                @if (tab.icon) {
                    <span [ngClass]="tab.icon"></span>
                }
                {{ tab.title }}
                @if (closableTabs()) {
                    <button
                        type="button"
                        class="p-message-close-button p-tabs-tab-closebutton"
                        (click)="closeTab(tab.value)"
                    >
                        <TimesIcon styleClass="p-message-close-icon" />
                    </button>
                }
            </p-tab>
        }
    </p-tablist>
    <p-tabpanels>
        @if (firstTabTemplate) {
            <p-tabpanel [value]="0">
                <ng-container
                    *ngTemplateOutlet="
                        firstTabTemplate;
                        context: {
                            updateTabEntityFn: onUpdateTabEntity,
                        }
                    "
                ></ng-container>
            </p-tabpanel>
        }

        @for (tab of openTabs; track tab.value) {
            <p-tabpanel [value]="tab.value">
                @if (entityTabTemplate && tab.tabType === TabType.Display) {
                    <ng-container
                        *ngTemplateOutlet="
                            entityTabTemplate;
                            context: {
                                $implicit: tab.entity,
                                updateTabTitleFn: onUpdateTabTitle,
                                updateTabEntityFn: onUpdateTabEntity,
                                beginEntityEditFn: onBeginEntityEdit,
                            }
                        "
                    ></ng-container>
                }
                @if (formTabTemplate() && (tab.tabType === TabType.New || tab.tabType === TabType.Edit)) {
                    <ng-container
                        *ngTemplateOutlet="
                            formTabTemplate();
                            context: {
                                $implicit: tab.entity,
                                updateTabTitleFn: onUpdateTabTitle,
                                updateTabEntityFn: onUpdateTabEntity,
                                tabForm: tab.form,
                                tabType: tab.tabType,
                                destroyFormFn: onDestroyForm,
                                submitFormFn: onSubmitForm,
                                cancelFormFn: onCancelForm,
                            }
                        "
                    ></ng-container>
                }
            </p-tabpanel>
        }
    </p-tabpanels>
</p-tabs>
